( Solo Forth library )                                          \ Copyright (C) 2015 Marcos Cruz (programandala.net)            \ This file is part of Solo Forth                               \ http://programandala.net/en.program.solo_forth.html           \ This file is the library of Solo Forth,                       \ and the skeleton to build applications in Solo Forth.         \ ------------------------------------------------------------  \ Acknowledgements                                              \ See <AKNOWLEDGMENTS.adoc>.                                    \ ------------------------------------------------------------  \ License                                                       \ Copying and distribution of this file, with or without        \ modification, are permitted in any medium without royalty     \ provided the copyright notice, the aknowledgments file and    \ this notice are preserved.  This file is offered as-is,       \ without any warranty.                                         ( ) \ scr 1 -- testing load screen                              3 load                                                          require decode                                                  require dump                                                    decode dump                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ( require ) \ scr 2                                             : reload  ( -- )  scr @ load  ;                                 : contains  ( ca1 len1 ca2 len2 -- f )  search nip nip  ;       2variable locatable  scr/disk 1 locatable 2!                    : located  ( ca len -- screen | false )                           locatable 2@ do                                                   0 i (line) 2over contains if  2drop i unloop exit  then       loop  2drop false  ;                                          : locate  ( "name" -- screen | false )                            parse-name save-string located  ;                             -->                                                                                                                                                                                                                                                                                                                                                                                             ( require ) \ scr 3                                             : do-required  ( ca len -- )                                      located dup 0= 29 ?error load  ;                              : do-require  ( "name" -- )                                       parse-name save-string do-required  ;                         : required  ( ca len -- )                                         2dup undefined?                                                   if  2dup do-required  then                                    2dup undefined? warnings @ and                                    if  type 28 warning exit  then  2drop  ;                    : require  ( "name" -- )                                          parse-name save-string required  ;                                                                                                                                                                                                                                                                                            ( Error messages 1..15 ) \ scr 4                                \ Error #1: Not a word nor a number.                            \ Error #2: Stack empty.                                        \ Error #3: Dictionary full.                                    \ Error #4: Warning: Is not unique.                             \ Error #5: Word not found.                                     \ Error #6: Out of disk range                                   \ Error #7: Full stack.                                         \ Error #8:                                                     \ Error #9: Trying to load from screen 0.                       \ Error #10:                                                    \ Error #11:                                                    \ Error #12:                                                    \ Error #13:                                                    \ Error #14:                                                    \ Error #15: Deferred word is uninitialized.                    ( Error messages 16..30 )  \ scr 5                              \ Error #16:                                                    \ Error #17: Compilation only, use in definition.               \ Error #18: Execution only.                                    \ Error #19: Conditionals not paired.                           \ Error #20: Definition not finished.                           \ Error #21:                                                    \ Error #22: Use only when loading.                             \ Error #23: Off current editing screen.                        \ Error #24:                                                    \ Error #25: Unsupported tape operation.                        \ Error #26: Unsupported disk operation.                        \ Error #27: Source file needed.                                \ Error #28: Warning: Not present, though required.             \ Error #29: Required, but not located.                         \ Error #30: Branch too long.                                   ( place +place )                                                : place  ( ca1 len1 ca2 )  2dup c! 1+ smove  ;                  : +place  ( ca1 len1 ca2 )                                        2dup c@ + over c!  dup c@ 1+ + smove  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ( /string )                                                     require -rot                                                    : /string  ( ca1 len1 n -- ca2 len2 )                             rot over + -rot -  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ( s' )                                                          : s'  ( compilation: "ccc<'>" -- ) ( run-time:  -- ca len )       [char] ' (s)  ; immediate                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ( -rot )                                                        code -rot  ( x1 x2 x3 -- x3 x1 x2 )                               E1 c, D1 c,      \ pop hl / pop de                              E3 c,            \ ex (sp),hl                                   EB c,            \ ex de,hl                                     C3 c, pushhlde , \ jp pushhlde                                  end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( 2nip )                                                        code 2nip  ( x1 x2 x3 x4 -- x3 x4 )                               E1 c,            \ pop hl                                       D1 c,            \ pop de                                       F1 c,            \ pop af                                       F1 c,            \ pop af                                       C3 c, pushhlde , \ jp pushhlde                                  end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( n>r nr> )                                                     code n>r  ( x0..xn n -- ) ( R: -- x0..xn n )                      end-code                                                      code nr>  ( -- x0..xn n ) ( R: x0..xn n -- )                      end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( emmited )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ( pixel )                                                       require pixel-add                                               code pixel  ( xc yc -- n a )                                      E1 c,  D1 c,            \ pop hl / pop de                       C5 c,                   \ push bc                               40 05 + c,              \ ld b,l ; b=y                          48 03 + c,              \ ld c,e ; c=x                          CD c, pixel-add ,       \ call pixel-add                        C1 c,                   \ pop bc                                16 c, 0 c,  58 07 + c,  \ ld d,0 / ld e,a                       C3 c, pushhlde ,        \ jp pushhlde                           end-code                                                                                                                                                                                                                                                                                                                      ( pixel-add )                                                   require z80-asm                                                 create pixel-add  ( -- a )                                        asm                                                             BF a ld#  b sub  a b ld                                         a and rra scf rra a and rra b xor F8 and b xor h a ld           c a ld                                                          end-asm                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ( pixel-add )                                                   create pixel-add  ( -- a )                                        asm                                                             3E c, BF c,   \ ld a,191 ; max Y coordinate                     90 00 + c,    \ sub b                                           C3 c, 22B0 ,  \ jp 0x22B0 ; and return                          end-asm                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ( plot )                                                        require pixel-add                                               code plot  ( xc yc -- )                                           D9 c,               \ exx                                       E1 c,               \ pop hl                                    C1 c,               \ pop bc                                    40 05 + c,          \ ld b,l                                    ED c, 43 c, 5C7D ,  \ ld (0x5C7D),bc ; update COORDS            CD c, pixel-add ,   \ call pixel-add                            CD c, 22EC ,        \ call 0x22EB ; ROM PLOT-SUB + 7            D9 c,               \ exx                                       DD c, 21 c, next ,  \ ld ix,next ; restore ix                   jpnext              \ jp (ix)                                   end-code                                                                                                                                                                                      ( set-pixel )                                                   require pixel-add  require z80-asm                              code set-pixel  ( xc yc -- )                                      hl pop  de pop  bc push                                         l b ld  e c ld  pixel-add call                                  a b ld  b inc  1 a ld#                                          <mark  a rrc  djnz                                              m or  a m ld  \ combine pixel with byte in the screen           bc pop  next,                                                   end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( reset-pixel )                                                 require pixel-add  require z80-asm                              code reset-pixel  ( xc yc -- )                                    hl pop  de pop  bc push                                         l b ld  e c ld  pixel-add call                                  a b ld  b inc  1 a ld#                                          <mark  a rrc  djnz                                              cpl  m and  a m ld  \ combine pixel with byte in the screen     bc pop  next,                                                   end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( toggle-pixel )                                                require pixel-add  require z80-asm                              code toggle-pixel  ( xc yc -- )                                   hl pop  de pop  bc push                                         l b ld  e c ld  pixel-add call                                  a b ld  b inc  1 a ld#                                          <mark  a rrc  djnz                                              m xor  a m ld  \ combine pixel with byte in the screen          bc pop  next,                                                   end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( pixel? )                                                      require pixel-add  require z80-asm                              code pixel?  ( xc yc -- f )                                       hl pop  de pop  bc push                                         l b ld  e c ld                                                  pixel-add call                                                  a b ld  b inc  m a ld                                           here  rlca djnz \ rotate to bit 0                               bc pop  \ restore the Forth IP                                  1 and#  \ pixel?                                                ' true cfa>pfa jpnz                                             ' false cfa>pfa jp                                              end-code                                                                                                                                                                                                                                                      ( pixel? )                                                      require pixel-add                                               code pixel?  ( xc yc -- f )                                       E1 c, D1 c, C5 c,       \ pop hl / pop de / push bc             40 05 + c, 48 03 + c,   \ ld b,l / ld c,e                       CD c, pixel-add ,       \ call pixel-add                        40 07 + c, 04 c, 7E c,                                          07 c,  10 c, FD c,      \ rlca / djnz rotate                    E6 c, 01 c,             \ and 1                                 26 c, 00 c,  68 07 + c, \ ld h,0 / ld l,a                       C1 c,  C3 c, pushhl ,   \ jp pushhl                             end-code                                                                                                                                                                                                                                                                                                                      ( rdraw )                                                       require z80-asm                                                 code rdraw  ( x y -- )                                            hl pop  de pop  bc push                                         de bc ldp                                                       1 e ld#                                                         7 b bit  \ negative x?                                          nz if  c a ld  neg  -1 e ld#  a c ld  then  \ negative x        l b ld   \ y                                                    1 d ld#                                                         7 h bit  \ negative y?                                          nz if  b a ld  neg  -1 d ld#  a b ld  then  \ negative y        24BA call \ alternative entry to the DRAW-LINE ROM routine      bc pop                                                          jpnext end-code                                                                                                               ( adraw ) \ from Abersoft Forth                                 require plot                                                    2variable x1  2variable incx  2variable y1  2variable incy      : adraw  ( x y -- )                                               23678 c@ ( y0 ) dup 0 swap y1 2! - dup abs rot                  23677 c@ ( x0 ) dup 0 swap x1 2! - dup abs rot                  max >r dup 0<  \ negative xdiff?                                if    abs 0 swap r@ m/mod dnegate                               else  0 swap r@ m/mod  then                                     incx 2! drop dup 0<  \ negative ydiff?                          if    abs 0 swap r@ m/mod dnegate                               else  0 swap r@ m/mod  then                                     incy 2! drop r> 1+ 0                                            do  x1 @ y1 @ plot                                                  x1 2@ incx 2@ d+ x1 2!                                          y1 2@ incy 2@ d+ y1 2!  loop  ;                           ( attr )                                                        require attr-addr                                               code attr ( line col -- b )                                       E1 c,  D1 c,                                                    50 05 + c,                                                      6E c,  26 c, 00 c,  pushhl,                                     end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( attr-addr )                                                   require z80-asm                                                 create attr-addr  ( -- a )                                        asm                                                             78 03 + c, \ ld a,e  ; line to a 0x00..0x17   (max 00010111)    0F c, 0F c, 0F c, \ rrca | rrca | rrca  ; rotate bits left      58 07 + c, \ ld e,a ; store in d as an intermediate value.      E6 c, E0 c, \ and 0xE0 ; pick up bits 11100000 (was 00011100)   A8 02 + c, \ xor d ; combine with column 0x00..0x1F             68 07 + c, \ ld l,a ; low byte now correct.                     78 03 + c, \ ld a,e ; bring back intermediate result from d     E6 c, 03 c,  EE c, 58 c,                                        60 07 + c, \ ld h,a ; high byte correct.                        C9 c,  \ ret                                                    end-asm                                                                                                                       ( emitted? )                                                    code emitted? ( row col -- f )                                    end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( circle )                                                      require z80-asm                                                 create circle-plot  ( -- a )                                      asm                                                             hl push  bc push  de push                                       ' plot cfa>pfa call  \ XXX TODO                                 de pop  bc pop  hl pop  ret                                     end-asm                                                       code circle  ( x y radius -- )                                    0 h ld#  l a ld                                                 exx  cpl  a c ld  FF b ld#                                      bc incp  \ bc' is -radius                                       end-code                                                                                                                                                                                                                                                      ( fade )                                                        require z80-asm                                                 code fade  ( -- )                                                 bc push                                                         8 b ld#                                                         <mark  5AFF hl ldp#  halt  halt                                   begin                                                             m a ld  a d ld  07 and#  nz if  a dec  then                     a e ld  a d ld  38 and#  nz if  8 sub#  then                    e or  d xor  3F and#  d xor                                     a m ld  hl decp  h a ld                                         58 cp#                                                        cy until                                                      djnz \ loop                                                     bc pop  next,                                                   end-code                                                      ( inverted )                                                    require z80-asm                                                 code inverted  ( -- )                                             4000 hl ldp#                                                    <mark   m a ld  cpl  a m ld                                             hl incp  h a ld  58 cp#                                         jrnz                                                    jpnext                                                          end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( water )                                                       require z80-asm                                                 code water  ( -- )                                                bc push                                                         20 b ld#                                                        <mark    57FF hl ldp#                                                     <mark   m rrc  hl decp  6 h bit  jrnz                           djnz                                                  bc pop  jpnext                                                  end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( clsx )                                                        require z80-asm                                                 code clsx  ( -- )                                                 bc push                                                         6 b ld#                                                         <mark   bc push  57FF hl ldp#                                           <mark   20 c ld#  a and                                                 <mark   nop  m sla                                                      nop  m rlc                                                      nop  m sla                                                      nop  hl decp  c dec  jrnz                               3F a ld#  h cp  jrnz                                    bc pop  djnz                                            bc pop  jpnext                                                  end-code                                                                                                                      ( sound vol shutup noise )                                      require !p                                                      [defined] sound-register-port                                     ?\ 65533 constant sound-register-port                         [defined] sound-write-port                                        ?\ 49149 constant sound-write-port                            : sound  ( b1 b2 -- )                                             sound-register-port !p sound-write-port !p  ;                 : vol  ( n1 n2 -- )  8 + sound  ;                               : shutup  ( -- )  -1 7 sound  ;                                 : noise  ( -- )  7 7 sound  ;                                                                                                                                                                                                                                                                                                                                                                   ( music )                                                       require ms  vocabulary music  current @  also music definitions : freq                                                            2* 109.375 3 roll  um/mod nip 256 /mod 2 pick                   1+ sound  swap sound  ;                                       variable len  variable tempo  variable octave  variable volume  2 len !  200 tempo !  8 octave !  15 volume ! 1 15 vol          : tones  ( -- )  56 7 sound  ;                                  : note  ( n "name" -- )                                           create  ,                                                       does>   @ octave @ * 16 /  1 freq tones                                 tempo @ len @ * ms shutup  ;                          523 note c  554 note c# 583 note d  622 note d#                 659 note e  698 note f  740 note f# 784 note g                  831 note g# 880 note a  932 note a# 988 note b                  -->                                                             ( music )                                                       : l  ( n -- )  len !  ;                                         : o+  ( -- )  octave @ 2 * octave !  ;                          : o-  ( -- )  octave @ 2 / octave !  ;                          : r  ( -- )  tempo @ len @ * ms  ;                              : >>  ( -- )  1 volume @ 1+ vol 1 volume +!  ;                  : <<  ( -- )  1 volume @ 1- vol -1 volume +!  ;                 current ! previous                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ( waves shoot helicopter train )                                create waves  ( -- a )                                            0 c,  0 c,  0 c,  0 c,  0 c,  0 c,  7 c,                        71 c,  20 c,  20 c,  20 c,  0 c,  38 c,  14 c,                create shoot  ( -- a )                                            10 c,  0 c,  177 c,  0 c,  191 c,  0 c,  31 c,                  71 c,  20 c,  20 c,  20 c,  92 c,  28 c,  3 c,                create helicopter  ( -- a )                                       200 c,  15 c,  200 c,  15 c,  200 c,  15 c,  0 c,               7 c, 23 c,  23 c,  23 c,  255 c,  1 c,  12 c,                 create train  ( -- a )                                            100 c,  120 c,  48 c,  97 c,  12 c,  200 c,  55 c,              15 c,  9 c,  11 c,  55 c,  180 c,  4 c,  8 c,                                                                                                                                                                                                                 ( play )                                                        require !p                                                      [defined] sound-register-port                                     ?\ 65533 constant sound-register-port                         [defined] sound-write-port                                        ?\ 49149 constant sound-write-port                            : play  ( a -- )                                                  14 0 do                                                           i sound-register-port !p  c@ sound-write-port !p 1+           loop  drop  ;                                                 : sound:  ( b0 ... b13 "name" -- )                                create  here 1- 14 allot here -1 do  i c!  -1 +loop  ;                                                                                                                                                                                                                                                                        ( play )                                                        require z80-asm                                                 [defined] sound-register-port                                   ?\ 65533 constant sound-register-port                           [defined] sound-write-port                                      ?\ 49149 constant sound-write-port                              code play  ( a -- )                                               hl pop  bc push                                                 0E b ld#  00 e ld#                                              <mark   bc push                                                         e a ld  sound-register-port bc ldp#  a outbc                    m a ld  sound-write-port bc ldp#  a outbc                       hl incp  e inc  bc pop  \ next                          djnz                                                            bc pop  next,                                                   end-code                                                      ( sound effects )                                               require sound:  hex                                             00 00 00 00 00 00 1E 40 0F 10 0F 00 07 18 sound: aplausse       1B 00 09 00 00 00 1F C8 10 10 10 00 6B 10 sound: hammer         AB 03 2A 02 0C 01 00 F8 10 10 10 00 71 10 sound: bell1          66 00 4B 00 45 00 00 F8 10 10 10 00 22 10 sound: bell2          FC 06 DE 03 C3 04 00 F8 10 10 10 00 FF 10 sound: bell3          0C 1F 00 00 00 1F 07 E8 0F 10 0F 9A 00 18 sound: airplane       09 00 00 06 0C 00 0B C0 10 0E 10 3A 02 1C sound: helicopter     03 05 FC 04 0C 05 00 F8 10 10 10 FF FF 0E sound: background     00 00 00 00 00 00 06 C0 10 10 10 00 05 18 sound: rap            00 06 00 00 00 05 11 E8 10 10 10 00 0A 10 sound: drum           09 00 00 00 00 00 00 C0 10 10 10 03 09 10 sound: cymbal         00 00 00 00 00 00 0F C0 0B 10 10 FF 50 0E sound: beach          24 00 12 00 16 00 00 F8 10 10 10 00 10 18 sound: waterdrop        decimal                                                       ( bleep )                                                       code bleep  ( n1 n2 -- )                                          E1 c, D1 c, C5 c,   \ pop hl / pop de / push bc                 CD c, 03B5 ,        \ call rom_beeper                           C1 c,               \ pop bc                                    DD c, 21 c, next ,  \ ld ix,next ; restore ix                   jpnext              \ jp (ix)                                   end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( beep>bleep )                                                  : beep>bleep  ( freq duration -- n1 n2 )                          over 1000 */ swap                                               4375 100 rot */ 30 -  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ( laser-gun )                                                   require z80-asm                                                 code laser-gun  ( -- )                                            bc push                                                         5 b ld#                                                         0500 hl ldp#                                                    <mark   0001 de ldp#                                                    hl push  03B5 call  hl pop                                      0010 de ldp#  de subp                                           jrnz                                                    bc pop  next ix ldp#  next,                                     end-code                                                                                                                                                                                                                                                                                                                      ( white-noise )                                                 require z80-asm                                                 code white-noise  ( u -- )                                        de pop                                                          bc push  \ save the Forth IP                                    de bc ldp  0000 hl ldp#  \ bc=duration, hl=start of ROM         5C48 fta  a sra  a sra  a sra  07 and#  a d ld                  <mark   m e ld  hl incp  bc decp  bc push                               08 b ld#  \ bit counter                                         <mark   e a ld  10 and#  e rl  d or  FE out  \ beep                     djnz                                                    bc pop  c a ld  b or                                            jrnz                                                    bc pop  jpnext \ restore the Forth IP and go next               end-code                                                                                                                      ( exchange )                                                    : exchange  ( n1 a -- n2 )  dup @ rot rot !  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ( source )                                                      : source  ( -- a len )  \ ANS Forth                               blk @ ?dup if  block b/buf  else  tib #tib @  then  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ( under+ )                                                      : under+  ( n1 n2 n3 -- n4 n3 )  >r + r>  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ( within between )                                              : within  ( n1|u1 n2|u2 n3|u3 -- f )                              over - >r - r> u<  ;                                          require -rot                                                    : between  ( n1|u1 n2|u2 n3|u3 -- flag )                          over - -rot - u< 0=  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ( d0= d0< d< du< dmin dmax )                                    : d0=  ( d -- f )  or 0=  ;                                     : d0<  ( d -- f )  nip 0<  ;                                    ; d<  ( d1 d2 -- f )                                              rot 2dup = if  2drop u< exit  then  2nip >  ;                 : du<  ( ud1 ud2 -- f )                                           rot swap 2dup                                                   u<  if  2drop 2drop -1 exit  then                               -   if  2drop 0 exit  then  u<  ;                             : dmin  ( d1 d2 -- d1 | d2 )                                      2over 2over d< 0= if  2swap  then  2drop  ;                   : dmax  ( d1 d2 -- d1 | d2 )                                      2over 2over d< if  2swap  then  2drop  ;                                                                                                                                                                                                                      ( lshift )                                                      code lshift  ( x1 u -- x2 )                                       D1 c,           \ pop de                                        E1 c,           \ pop hl                                        1C c,           \ inc e                                         here            \ begin:                                        1D c,           \ dec e                                         CA c, pushhl ,  \ jp z,push_hl                                  29 c,           \ add hl,hl                                     C3 c, ,         \ jp begin                                      end-code                                                                                                                                                                                                                                                                                                                                                                                      ( rshift )                                                      code rshift  ( x1 u -- x2 )                                       D1 c,           \ pop de                                        E1 c,           \ pop hl                                        1C c,           \ inc e                                         here            \ begin:                                        1D c,           \ dec e                                         CA c, pushhl ,  \ jp z,push_hl                                  C3 c, ,         \ jp begin                                      end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( Symmetric-division operators )                                : /-rem  ( n1 n2 -- n3 n4 )  >r  s>d  r> sm/rem  ;              : /-  (  n1 n2 -- n3 )  /-rem nip  ;                            : -rem  ( n1 n2 -- n3 )  /-rem drop  ;                          : */-rem  (  n1 n2 n3 -- n4 n5 )  >r  m*  r> sm/rem  ;          : */-  ( n1 n2 n3 -- n4 )  */-rem nip  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ( Floored-division operators )                                  : /_mod  ( n1 n2 -- n3 n4)  >r s>d r> fm/mod  ;                 : /_  ( n1 n2 -- n3)  /_mod nip  ;                              : _mod  ( n1 n2 -- n3)  /_mod drop  ;                           : */_mod  ( n1 n2 n3 -- n4 n5)  >r m* r> fm/mod  ;              : */_  ( n1 n2 n3 -- n4 )   */_mod nip  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ( fig-Forth +- d+- )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( [if] [else] [then] )                                          [defined] s=  ?\  : s=  ( ca1 len1 ca2 len2 )  compare 0=  ;    : [else]  ( "..." -- )                                            1 begin   parse-name 2dup swap c@ and                             while   2dup s" [if]" s=                                                if    2drop 1+                                                  else  2dup s" [else]" s=                                              if    2drop 1- dup if  1+  then                                 else  s" [then]" s= if  1-  then                                then                                                      then  ?dup 0= if  exit  then                          repeat  2drop drop  ; immediate                               : [if]  ( "..." -- )  0= if postpone [else] then  ; immediate   : [then]  ( -- )  ; immediate                                                                                                                                                                   ( ufia )                                                        24 constant /ufia                                               create ufia  /ufia allot  ufia /ufia erase                      ufia      constant dstr1 \ drive: 1 or 2                        ufia 1+   constant fstr1 \ program number                       ufia 2+   constant sstr1 \ stream number                        ufia 3 +  constant device \ device: "D" or "d"                  ufia 4 +  constant nstr1 \ directory description                ufia 5 +  constant nstr2 \ file name                            ufia 15 + constant hd00  \ file type                            ufia 16 + constant hd0b  \ file length                          ufia 18 + constant hd0d  \ file start address                   char d device c! \ "d" or "D"                                   2 sstr1 c! \ stream 2                                           0 variable file-length                                          0 variable file-address                                         ( File types and directory descriptions)                        0 constant basic-filetype  1 constant data-array-filetype       2 constant string-array-filetype  3 constant code-filetype        01 constant basic-file      02 constant data-array              03 constant string-array    04 constant code-file               05 constant snapshot-48k    06 constant microdrive-file         07 constant screens$-file   08 constant special-file            09 constant snapshot-128k   10 constant opentype-file           11 constant execute-file                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( --hook-codes-- )                                              hex                                                             33 constant hxfer 34 constant ofsm  35 constant hofle           36 constant sbyt  37 constant hsvbk 38 constant cfsm            39 constant pntp  3A constant cops  3B constant hgfle           3C constant lbyt  3D constant hldbk 3E constant wsad            3F constant sad   40 constant rest  41 constant heraz           42 constant cops2 43 constant pcat  44 constant hrsad           45 constant hwsad 46 constant otfoc 47 constant patch           decimal                                                         : --hook-codes--  ( -- )  noop  ;                                                                                                                                                                                                                                                                                                                                                               ( ior>error ?dos-error )                                        : ior>error  ( ior -- f n )                                       dup 1 and    \ error?                                           swap 255 /   \ error code                                       dup 128 and  \ ZX Spectrum error?                               if  negate  else  100 +  then   ;                             : ?dos-error  ( ior -- )                                          ior>error ?error  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           ( drive@ drive! )                                               require z80-asm  require --hook-codes--                         code drive@  ( -- n )                                             bc push  ix push  \ save the Forth registers                    patch hook                                                      3ACE fta  \ XXX NEW                                             E7 out  \ page +D out                                           ix pop  bc pop  \ restore the Forth registers                   0 h ld#  a l ld  pushhl jp  end-code                          code drive!  ( n -- )                                             hl pop                                                          bc push  ix push  \ save the Forth registers                    l a ld  21 hook                                                 ix pop  bc pop  \ restore the Forth registers                   jpnext  end-code                                                                                                              ( -filename filename! >ufia filename>ufia )                     require ufia  require drive@                                    10 constant /filename  \ max filename length                    : -filename  ( -- )  nstr2 /filename blank  ;                   : filename!  ( ca len -- )                                        -filename /filename min nstr2 swap cmove  ;                   : >ufia  ( a1 len1 ca2 len2 -- )                                  3 hd00 c!  4 nstr1 c!  \ code filetype and dir description      filename!                                                       dup hd0b !  file-length !                                       dup hd0d !  file-address !                                      drive@ dstr1 c!  ;                                            : filename>ufia  ( ca len -- )  0 0 2swap >ufia  ;                                                                                                                                                                                                              ( >file? >file )                                                require z80-asm  require ufia                                   code (>file)  ( -- ior )                                          bc push  ix push  \ save the Forth registers                    ufia ix ldp#                                                    hofle hook \ open the file and create its header                nc if \ no error?                                                 hd0d de ldp \ start                                             hd0b bc ldp \ length                                            hsvbk hook \ save to file                                       nc if  cfsm hook  then  \ close the file if no error          then  ix pop  bc pop  \ restore the Forth registers             af push  \ ior                                                  jpnext                                                          end-code  -->                                                                                                                 ( >file? >file )                                                : >file?  ( ca1 len1 ca2 len2 -- f n )                            >ufia (>file) ior>error  ;                                    : >file  ( ca1 len1 ca2 len2 -- )                                 >file? ?error  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ( <file? <file )                                                require z80-asm  require ufia  require --hook-codes--           code (<file)  ( -- ior )                                          bc push  ix push  \ save the Forth registers                    ufia ix ldp#  hgfle hook \ get the file                         nc if \ no error?  -- load the file header:                       hd00 de ldp# 9 b ld# \ destination and count                    begin                                                             lbyt hook \ load byte and store it in A                         de stap  de incp  \ update destination and count              dsz                                                         -->                                                                                                                                                                                                                                                                                                                             ( <file? <file )                                                    file-address de ldp                                             file-length bc ldp                                              bc tstp  \ is the lenght zero?                                  z if  hd0b bc ldp  then                                         hldbk hook                                                    then                                                            ix pop  bc pop  \ restore the Forth registers                   af push  \ ior                                                  jpnext                                                        end-code                                                        : <file?  ( a1 len1 ca2 len2 -- f n )                             >ufia (<file) ior>error  ;                                    : <file  ( a1 len1 ca2 len2 -- )                                  <file? ?error  ;                                                                                                              ( -file? -file )                                                require z80-asm  require ufia  require --hook-codes--           code (-file)  ( -- ior )                                          bc push  ix push  \ save the Forth registers                    ufia ix ldp#                                                    heraz hook \ erase the file                                     ix pop  bc pop  \ restore the Forth registers                   af push                                                         jpnext                                                          end-code                                                      : -file?  ( ca len -- f n )                                       filename>ufia (-file) ior>error  ;                            : -file  ( ca len -- )                                            -file? ?error  ;                                                                                                                                                                              ( file? )                                                       require ufia  require filename!  require --hook-codes--         code (file?)  ( -- f )                                            bc push  ix push  \ save the Forth registers                    patch hook                                                      nstr2 ix ldp#  1146 call                                        E7 out  \ page +D out                                           ix pop  bc pop  \ restore the Forth registers                   0 hl ldp#  pushhl jpnz                                          hl incp    pushhl jp                                            end-code                                                      : file?  ( ca len -- f )  filename! (file?)  ;                                                                                                                                                                                                                                                                                  ( cat acat )                                                    require z80-asm  require ufia  require --hook-codes--           require filename>ufia                                           hex 3E01 constant ufia1 decimal                                 code (cat)  ( n -- )                                              af pop                                                          bc push  ix push  \ save the Forth registers                    af push  patch hook                                             ufia hl ldp#  ufia1 de ldp#  /ufia bc ldp#  ldir                hl pop  l a ld  \ cat type: 2=compact;4=detailed                24B5 call \ CAT_RUN                                             168E call \ BORD_REST = restore the border                      E7 out  \ page +D out                                           ix pop  bc pop  jpnext  end-code                              : cat  ( ca len -- )  filename>ufia  4 (cat)  ;                 : acat  ( ca len -- )  filename>ufia  2 (cat)  ;  decimal       ( c@dos )                                                       require z80-asm  require --hook-codes--                         code c@dos  ( a -- b )                                            hl pop                                                          bc push  ix push  \ save the Forth registers                    hl push                                                         patch hook                                                      hl pop                                                          (hl) a ld 0 h ld#  a l ld                                       E7 out  \ page +D out                                           ix pop  bc pop  \ restore the Forth registers                   pushhl jp                                                       end-code                                                                                                                                                                                                                                                      ( @dos )                                                        require z80-asm  require --hook-codes--                         code @dos  ( a -- n )                                             hl pop                                                          bc push  ix push  \ save the Forth registers                    hl push                                                         patch hook                                                      hl pop (hl) e ld  hl incp  (hl) d ld                            E7 out  \ page +D out                                           ix pop  bc pop  \ restore the Forth registers                   de push                                                         jpnext                                                          end-code                                                                                                                                                                                                                                                      ( c!dos )                                                       require z80-asm  require --hook-codes--                         code c!dos  ( b a -- )                                            hl pop  de pop                                                  bc push  ix push  \ save the Forth registers                    de push hl push                                                 patch hook                                                      hl pop  de pop  e (hl) ld                                       E7 out  \ page +D out                                           ix pop  bc pop  \ restore the Forth registers                   jpnext                                                          end-code                                                                                                                                                                                                                                                                                                                      ( !dos )                                                        require z80-asm  require --hook-codes--                         code !dos  ( n a -- )                                             hl pop  de pop                                                  bc push  ix push  \ save the Forth registers                    de push  hl push                                                patch hook                                                      hl pop  de pop  e (hl) ld  hl incp  d (hl) ld                   E7 out  \ page +D out                                           ix pop  bc pop  \ restore the Forth registers                   jpnext                                                          end-code                                                                                                                                                                                                                                                                                                                      ( c@dosvar )                                                    require z80-asm  require --hook-codes--                         [defined] dos-vars ?\ 8192 constant dos-vars                    code c@dosvar  ( n -- b )                                         hl pop                                                          bc push  ix push  \ save the Forth registers                    hl push                                                         patch hook                                                      hl pop  dos-vars de ldp#  de addp                               (hl) a ld 0 d ld#  a e ld                                       E7 out  \ page +D out                                           ix pop  bc pop  \ restore the Forth registers                   de push                                                         jpnext                                                          end-code                                                                                                                      ( @dosvar )                                                     require z80-asm  require --hook-codes--                         [defined] dos-vars ?\ 8192 constant dos-vars                    code @dosvar  ( n1 -- n2 )                                        hl pop                                                          bc push  ix push  \ save the Forth registers                    hl push                                                         patch hook                                                      hl pop  dos-vars de ldp#  de addp                               (hl) e ld  hl incp  (hl) d ld                                   E7 out  \ page +D out                                           ix pop  bc pop  \ restore the Forth registers                   de push                                                         jpnext                                                          end-code                                                                                                                      ( c!dosvar )                                                    require z80-asm  require --hook-codes--                         [defined] dos-vars ?\ 8192 constant dos-vars                    code c!dosvar  ( b n -- )                                         hl pop  de pop                                                  bc push  ix push  \ save the Forth registers                    de push hl push                                                 patch hook                                                      hl pop  dos-vars de ldp#  de addp  de pop                       e (hl) ld                                                       E7 out  \ page +D out                                           ix pop  bc pop  \ restore the Forth registers                   jpnext                                                          end-code                                                                                                                                                                                      ( !dosvar )                                                     require z80-asm  require --hook-codes--                         [defined] dos-vars ?\ 8192 constant dos-vars                    code !dosvar  ( n1 n2 -- )                                        hl pop  de pop                                                  bc push  ix push  \ save the Forth registers                    de push  hl push                                                patch hook                                                      hl pop  dos-vars de ldp#  de addp  de pop                       e (hl) ld  hl incp  d (hl) ld                                   E7 out  \ page +D out                                           ix pop  bc pop  \ restore the Forth registers                   jpnext                                                          end-code                                                                                                                                                                                      ( update flush )                                                : update  ( -- )                                                  disk-buffer @                                                   [ base @ hex ] 8000 [ base ! ] or                               disk-buffer !  ;                                              : flush  ( -- )  save-buffers empty-buffers  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ( transient[ )                                                  variable old-dp                                                 variable old-np                                                 variable old-latest                                             variable old-voc-link                                           : transient[  ( u -- )                                            here        old-dp !                                            np@         old-np !                                            latest      old-latest !                                        voc-link @  old-voc-link !                                      0 swap - dp !  ;                                              : ]transient  ( -- )                                              old-dp @ dp !  old-np @ np !  ;                               : -transient  ( -- )                                              old-voc-link @ voc-link !                                       old-latest @ old-np @ cfap>lfa !n  ;                          ( [false] [true] )                                                       0 constant [false] immediate                           [false] 0= constant [true]  immediate                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           ( hex. hexb. dhex. <hex hex> )                                  [defined] base'  ?\ variable base'                              [defined] (d.)                                                  ?\ : (d.)  ( d n -- ca len )  <# 0 do  #  loop  #>  ;           : <hex  ( -- )  base @ base' ! hex ; \ switch to hex            : hex>  ( -- )  base' @ base !     ; \ and back                 : (dhex.)  ( d n -- )  <hex (d.) hex> type space  ;             : dhex.    ( d -- )  8 (dhex.)  ;                               : hex.     ( n -- )  s>d 4 (dhex.)  ;                           : hexb.    ( b -- )  s>d 2 (dhex.)  ;                                                                                                                                                                                                                                                                                                                                                                                                                           ( binary bin. binb. dbin. <bin bin> )                           [defined] base'  ?\ variable base'                              base @ decimal                                                  [defined] binary  ?\ : binary  ( -- )  2 base !  ;              base !                                                          [defined] (d.)                                                  ?\ : (d.)  ( d n -- ca len )  <# 0 do  #  loop  #>  ;           : <bin  ( -- )  base @ base' ! binary ; \ switch to binary      : bin>  ( -- )  base' @ base !        ; \ and back              : (dbin.)  ( d n -- )  bin{ (d.) }bin type space  ;             : dbin.    ( d -- )  32 (dbin.)  ;                              : bin.     ( n -- )  s>d 16 (dbin.)  ;                          : binb.    ( b -- )  s>d 8 (dbin.)  ;                                                                                                                                                                                                                           ( ascii-type )                                                  : ascii-type  ( ca len -- )                                       dup if                                                            bounds do                                                         i c@ 127 and dup bl < if  drop [char] .  then  emit           loop                                                          else  2drop  then  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ( dump )                                                        require break-key?  require hex.  require ascii-type            [defined] bs ?\ : bs  ( -- )  8 emit  ;                         : dump  ( a len -- )                                              7 + -8 and 8 / 0                                                2dup <> if                                                        do                                                                cr dup hex.                                                     8 0 do  i over + @ flip hex.  2 +loop                           dup bs 8 ascii-type                                             break-key? if  exhaust  then                                  8 + loop                                                      else  2drop  then  drop  ;                                                                                                                                                                                                                                    ( decode )                                                      forth definitions decimal                                       variable decode-level  decode-level off \ depth of nesting      variable decode-address  \ in the word being decoded            : indent  ( -- )                                                  cr decode-address @ u. decode-level @ 2 * spaces  ;           : indent+  ( -- )  1 decode-level +! indent  ;                  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( decode )                                                      : decode-compile    ( a1 -- a2 )  2+ dup @ 2+ pfa>nfa id.  ;    : decode-literal    ( a1 -- a2 )  2+ dup @ .  ;                 : decode-cliteral   ( a1 -- a2 )  2+ dup c@ . 1-  ;             : decode-branch     ( a1 -- a2 )  2+ dup @ u.  ;                : decode-dot-quote  ( a1 -- a2 )                                  2+ dup count type  dup c@ + 1 -  ;                            -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( decode )                                                      require case                                                    : decode-special  ( a1 -- a1 | a2 )                               dup @                                                           case                                                              ['] compile   of  decode-compile    endof                       ['] lit       of  decode-literal    endof                       ['] clit      of  decode-cliteral   endof                       ['] branch    of  decode-branch     endof                       ['] 0branch   of  decode-branch     endof                       ['] ?branch   of  decode-branch     endof                       ['] (loop)    of  decode-branch     endof                       ['] (+loop)   of  decode-branch     endof                       ['] (.")      of  decode-dot-quote  endof                     endcase  ;  -->                                                                                                               ( decode )                                                      : decode-end?  ( cfa -- f )                                       dup  ['] ;s =  swap ['] (;code) =  or  ;                      : colon-pfa?  ( pfa -- f )                                        pfa>cfa @ ['] : @ =  ;                                        -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( decode )                                                      : (decode)  ( pfa --- )                                           dup colon-pfa? if                                                 dup pfa>cfa decode-address ! indent  ." : " dup pfa>nfa id.     begin   ( pfa+n ) dup decode-address !                                  dup @ dup ( pfa+n cfa cfa ) decode-end? 0=              while  \ high level & not end of colon definition                 ( pfa+n cfa ) 2+ ( pfa+n pfa' ) dup indent+  pfa>nfa id.        key case  [char] q  of  sp0 @ sp! quit  endof \ q                               bl  of  drop            endof \ space                                      swap recurse \ default                   endcase  decode-special                                     2+  -1 decode-level +!                                        repeat  indent 2+ pfa>nfa id. \ show the last word            else  ." Not a colon definition."  then  drop  ;  -->                                                                         ( decode )                                                      : decode-usage  ( -- )                                            cr ." Keys: space=more, q=quit, other=deeper." cr  ;          : decode  ( "name" -- )                                           decode-usage                                                    defined if  cfa>pfa  0 decode-level !  (decode)                         else  drop  5 error  then  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ( list )                                                        require break-key?                                              : list  ( n -- )                                                  dup scr !                                                       cr ." Scr # " .                                                 l/scr 0 do                                                        cr i 2 .r space i scr @ .line                                   break-key? if  exhaust  then                                  loop cr  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ( break-key? )                                                  code break-key?  ( -- f )                                         CD c, 1F54 ,              \ call rom_break_key                  D2 c, ' true cfa>pfa ,    \ jp nc,next                          C3 c, ' false cfa>pfa ,   \ jp z,next                           end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( index )                                                       require break-key?                                              : index  ( n1 n2 -- )                                             1+ swap do                                                        cr i 3 .r space 0 i .line                                       break-key? if  exhaust  then                                  loop  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ( words )                                                       require break-key?                                              [defined] tab ?\  : tab  ( -- )  6 emit  ;                      : words  ( -- )                                                   trail                                                           begin  dup 0<> break-key? 0= and  while                           dup id. tab  nfa>lfa @n                                       repeat drop  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ( words-like )                                                  require break-key?                                              [defined] contains                                                ?\ : contains  ( ca1 len1 ca2 len2 -- f )  search nip nip  ;  [defined] tab                                                     ?\  : tab  ( -- )  6 emit  ;                                  : words-like  ( "name" -- )                                       parse-name 2dup uppers trail  ( ca len nfa )                    begin  dup 0<> break-key? 0= and  while                           dup >r                                                          nfa>string 2over 2swap contains if  r@ id. tab  then            r> nfa>lfa @n                                                 repeat drop 2drop  ;                                                                                                                                                                                                                                          ( where )                                                       : where  ( -- )                                                   error-pos 2@  ( n1 n2 )                                         dup if                                                            dup b/scr / dup scr !                                           ." Scr # " decimal . cr                                         swap c/l /mod c/l * rot block + c/l type cr                     here c@ - spaces [char] ^ emit                                else  2drop  then  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ( .s )                                                          : .s   ( -- )                                                     depth                                                           dup s>d <# [char] > hold #s [char] < hold #> type space         if  sp@ 2- s0 @ 2- do i @ . -2 +loop  then  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( marker ) \ 2nd approach                                       : get-every-latest  ( -- nfa0..nfan | nfa )                       voc-link @ begin                                                  dup cell - @  ( a nfa ) swap @                                dup 0= until  drop  ;                                         : set-every-latest  ( nfa0..nfan | nfa -- )                       voc-link @ begin                                                  dup cell - @  ( a nfa ) swap @                                dup 0= until  drop  ;                                         : marker@  ( -- x1..xn1 n1 nfa1..nfan2 n2 )                       depth >r                                                        here np@ voc-link @                                             depth r> - get-every-latest  ;                                : marker!  ( a -- )                                               set-order 0 do  2@ !  loop  ;                                                                                                 ( marker )                                                      : n,  ( x1..xn n -- )  0 do  ,  loop  ;                         : marker  ( "name" -- )                                           marker@ create n,  does>  ( -- ) ( pfa )  marker!  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ( marker )                                                      : get-every-latest  ( -- nfa0..nfan | nfa )                       voc-link @ begin                                                  dup cell - @  ( a nfa ) swap @                                dup 0= until  drop  ;                                         : set-every-latest  ( nfa0..nfan | nfa -- )                       voc-link @ begin                                                  dup cell - @  ( a nfa ) swap @                                dup 0= until  drop  ;                                         : marker@  ( -- x1..xn1 n1 nfa1..nfan2 n2 )                       depth >r  here np@ voc-link @                                   depth r> - get-every-latest  ;                                : marker!  ( a -- )                                               dup @ dup voc-link !  cell+ dup @ np!  cell+ @ dp !  ;                                                                                                                                        ( marker )                                                      : n,  ( x1..xn n -- )  0 do  ,  loop  ;                         : marker  ( "name" -- )                                           marker@ create n,  does>  ( -- ) ( pfa )  marker!  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ( forget )                                                      : forget  ( "name" -- )                                           current @ context @ <>   \ Compare `current` with `context`.    24 ?error                \ If not the same, issue an error.     '                        \ Locate "name", return its cfa.       dup fence @ u<           \ Below `fence`?                       21 ?error                \ If so, issue an error.               dup  ( cfa cfa )                                                cfa>nfa dp !             \ Update the dictionary pointer.       cfa>lfa @ current @ !    \ Update the `current` vocabulary.     ;                                                                                                                                                                                                                                                                                                                                                                                             ( source )                                                      : source  ( -- ca len )  \ ANS Forth                              blk @ ?dup if  block b/buf  else  tib #tib @  then  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ( @p )                                                          code @p  ( ca -- c )                                              E1 c,           \ pop hl                                        C5 c,           \ push bc                                       48 05 + c,      \ ld c,l                                        40 04 + c,      \ ld b,h                                        ED c, 68 c,     \ in l,(c)                                      C1 c,           \ pop bc                                        26 c, 00 c,     \ ld h,0x00                                     C3 c, pushhl ,  \ jp pushhl                                     end-code                                                                                                                                                                                                                                                                                                                                                                                      ( !p )                                                          code !p  ( c ca -- )                                              E1 c,           \ pop hl                                        D1 c,           \ pop de ; char in e                            C5 c,           \ push bc                                       48 05 + c,      \ ld c,l                                        40 04 + c,      \ ld b,h                                        ED c, 59 c,     \ out (c),e                                     C1 c,           \ pop bc                                        jpnext          \ jp (ix)                                       end-code                                                                                                                                                                                                                                                                                                                                                                                      ( extend size system turnkey )                                  : extend  ( -- )                                                  latest 6 +origin !  \ top most word in `forth` vocabulary       here 22 +origin !  \ `fence` init value \ XXX OLD obsolete      here 24 +origin !   \ `dp` init value                           here fence ! \ XXX OLD obsolete                                 [ ' forth cfa>pfa 8 + ] literal 26 +origin !  ;               : size  ( -- u )  here 0 +origin -  ;                           : system  ( -- a len )  extend  0 +origin size 10 +  ;          : turnkey  ( cfa -- a len )  boot ! system  ;                                                                                                                                                                                                                                                                                                                                                                                                                   ( du.r u.r du. )                                                : du.r  ( d n -- )  >r <# #s #> r> over - 0 max spaces type  ;  \ : u.r  ( n1 n2 -- )  >r 0 r> du.r  ;                          : du.  ( d -- )  0 du.r space  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ( >number )                                                     require /string                                                 : >number  ( d1 ca1 len1 -- d2 ca2 len2 )                         begin   dup                                                     while   over c@ base @ digit                                    while   >r 2swap r> swap base @ um* drop rot base @                     um* d+ 2swap 1 /string 1 dpl +!                         repeat then  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ( number? )                                                     : number?  ( ca len -- d true | false )                           over c@ [char] - = over 0> and dup >r 1                         and /string over c@ [char] . > and 0 0                          2swap ?dup                                                      if                                                                >number dpl on dup                                              if  1- over c@ [char] . - or  dpl off  then                     while                                                           then r> 2drop 2drop false                                       else drop r> if  dnegate  then true                           then  ;                                                                                                                                                                                                                                                                                                                       ( b# d# h# )                                                    : x# ( -- ) ( 'ccc' -- n | d )                                    does> c@              \  new radix                              base @ >r  base !     \ save and set radix                      parse-name            \ get string                              ['] evaluate catch    \ convert to number, set trap             r> base !  throw  ;   \ restore radix before error control    create b# ( 'ccc' -- n | d )  2 c, x# immediate                 create d# ( 'ccc' -- n | d ) 10 c, x# immediate                 create h# ( 'ccc' -- n | d ) 16 c, x# immediate                                                                                                                                                                                                                                                                                                                                                                                                                 ( .b .d .h )                                                    : base.  ( -- )  does> c@ base @ >r base ! u. r> base !  ;      create bin.  ( n -- )   2 c, base.                              create dec.  ( n -- )  10 c, base.                              create hex.  ( n -- )  16 c, base.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ( c>hex )                                                       hex                                                             : c>hex  ( c -- n )                                               30 - dup 9 > if  7 -  then  ;                                 decimal                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ( '. ) \ character prefix                                       hex  width @ 1 width !                                          : '.  ( -- n )                                                    here 2 + c@ postpone literal  ; immediate                     width ! decimal                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( $.. $.... ) \ hex prefixes                                    require c>hex                                                   hex width @  1 width !                                          : $..  ( -- n )                                                   here 2 + c@ c>hex 10 * here 3 + c@ c>hex +                      postpone literal  ; immediate                                 : $....  ( -- n )                                                 0 here 6 + here 2 + do 10 * i c@ c>hex + loop                   postpone literal  ; immediate                                 width ! decimal                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( 0x.. 0x.... )  \ hex prefixes                                 require c>hex                                                   hex  width @ 2 width !                                          : 0x..  ( -- n )                                                  here 3 + c@ c>hex 10 * here 4 + c@ c>hex +                      postpone literal  ; immediate                                 : 0x....  ( -- n )                                                0 here 7 + here 3 + do 10 * i c@ c>hex + loop                   postpone literal  ; immediate                                 width ! decimal                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( #... #..... ) \ hex prefixes                                  require c>hex                                                   width @  1 width !                                              : #...  ( -- n )                                                  here 2 + c@ c>hex 10 * here 3 + c@ c>hex +                      postpone literal  ; immediate                                 : #.....  ( -- n )                                                0 here 6 + here 2 + do 10 * i c@ c>hex + loop                   postpone literal  ; immediate                                 width !                                                                                                                                                                                                                                                                                                                                                                                                                                                         ( ?do )                                                         : (do)  ( n1 n2 -- )  2>r  ;                                    : (?do) 2dup = if 2drop r> drop then  ;                         : (loop) ;                                                       ( increments index -2nd item- on return stack)              ( calculates flag for until )                              : (+loop) ;                                                     : do      postpone (do) postpone begin                            ; immediate                                                   : ?do     postpone (?do) postpone (do) postpone begin             ; immediate                                                   : loop    postpone (loop) postpone until postpone unloop          ; immediate                                                   : +loop   postpone (+loop) postpone until postpone unloop         ; immediate                                                                                                                   ( ?do )                                                         : do ( -- flag addr)                                              postpone (do) 0 postpone begin ; immediate    : ?do ( -- addr1 flag addr2)                                      postpone (?do) postpone begin                           postpone (do) 1 postpone begin ; immediate                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ( ?do )                                                         variable ?do?                                                   : exchange ( x1 addr -- x2 ) dup @ rot rot ! ;                  : 2dup<> ( x1 x2 -- x1 x2 flag ) 2dup = 0= ;                    : do                                                              postpone 2>r 0 ?do? exchange here                               ; immediate                                                   : ?do                                                             postpone 2dup<> postpone if postpone do ?do? on                 ; immediate                                                   : loop                                                            postpone (loop) , ?do? exchange if postpone then then           ; immediate                                                   : +loop                                                           postpone (+loop) , ?do? exchange if postpone then then          ; immediate                                                   ( ?do )                                                         variable ?do?                                                   : 2dup= ( x1 x2 -- x1 x2 flag ) 2dup = ;                        : do                                                              ?do? @ ?do? off [compile] (do) here 0 , ; immediate           : ?do                                                             postpone 2dup= postpone if postpone do ?do? on                  ; immediate                                                   : complete-?do ( x dest | x -- )                                  ?do? @ if postpone then then ?do? ! ;                         : loop postpone (loop) , complete-?do ; immediate               : +loop postpone (+loop) , complete-?do ; immediate                                                                                                                                                                                                                                                                             ( j )                                                           code j                                                            2A c, rp ,      \ ld hl,(return_stack_pointer)                  11 c, 2 cells , \ ld de,2*cell                                  19 c,           \ add hl,de                                     fetchhl,        \ jp fetchhl                                    end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( k )                                                           code k                                                            2A c, rp ,      \ ld hl,(return_stack_pointer)                  11 c, 4 cells , \ ld de,4*cell                                  19 c,           \ add hl,de                                     fetchhl,        \ jp fetchhl                                    end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( i' )                                                          code i'  ( -- x )                                                        ( R: loop-sys -- loop-sys )                              2A c, rp ,  \ ld hl,(return_stack_pointer)                      23 c,       \ inc hl                                            23 c,       \ inc hl                                            fetchhl,    \ jp fetchhl                                        end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( j' )                                                          code j'  ( -- x )                                                        ( R: loop-sys1 loop-sys2 -- loop-sys1 loop-sys2 )        2A c, rp ,      \ ld hl,(return_stack_pointer)                  11 c, 3 cells , \ ld de,3*cell                                  19 c,           \ add hl,de                                     fetchhl,        \ jp fetchhl                                    end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( for step )                                                    code (step)  ( R: n -- n' )                                       2A c, rp ,                                                      5E c, 23 c, 56 c,                                               7A c, B3 c,                                                     1B c, 72 c, 2B c, 73 c,                                         C2 c, ' branch cfa>pfa ,                                        23 c, 23 c, 22 c, rp ,                                          03 c, 03 c, next,                                               end-code                                                      : for  ( n -- )  postpone >r <mark  ; immediate                 : step  ( -- )  postpone (step) <resolve  ; immediate                                                                                                                                                                                                                                                                           ( case )  \ ANS Forth version                                   0 constant case immediate  \ init count of ofs                  : of                                                              1+ >r                                                           postpone over  postpone =   \ copy and test case value          postpone if                 \ add orig to control flow stack    postpone drop               \ discards case value if =          r>  ; immediate                                               : endof                                                           >r  postpone else  r>  ; immediate                            : endcase                                                         postpone drop  \ discard case value                             0 do  postpone then  loop  ; immediate                                                                                                                                                                                                                        ( case )  \ fig-Forth version with compiler security            : case                                                            ?comp csp @ !csp 4  ; immediate                               : of                                                              4 ?pairs                                                        postpone over  postpone =  postpone 0branch >mark               postpone drop 5  ; immediate                                  : endof                                                           5 ?pairs  postpone branch >mark                                           swap 2  postpone then  4  ; immediate               : endcase                                                         4 ?pairs                                                        postpone drop                                                   begin  sp@ csp @ <>  while  2 postpone then  repeat             csp !  ;  immediate                                                                                                           ( case )  \ fig-Forth version without compiler security         : case                                                            csp @ !csp  ; immediate                                       : of                                                              postpone over  postpone =  postpone if  postpone drop           ; immediate                                                   : endof                                                           postpone else  ; immediate                                    : endcase                                                         postpone drop                                                   begin  sp@ csp @ <>  while  postpone then  repeat               csp !  ;  immediate                                                                                                                                                                                                                                                                                                           ( ?dov dov loopv +loopv )                                       : dov  compile (do) csp @ !csp here 3  ;                        : ?dov                                                            compile 2dup  compile (do)  compile <>                          postpone if                                                     2drop here swap 1 6  ; immediate                              : (resolve)                                                       begin  sp@ csp @ -  while  2 postpone then  repeat  csp !  ;  : loopv                                                           postpone loop (resolve)  ;                                    : +loopv                                                          postpone +loop (resolve)  ;                                                                                                                                                                                                                                                                                                   ( case: )                                                       : case:  ( -- )                                                   create  ]                                                       does>   ( n -- )                                                        ( n pfa ) swap cells + perform  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ( associative: )                                                require -rot                                                    : associative:  ( n -- )                                          constant                                                        does>  ( x -- index )                                             ( x pfa )                                                       dup @ ( x pfa n ) -rot dup @ 0 ( n x pfa n 0 )                  do ( n x pfa )                                                    cell+ 2dup @ = ( n x pfa' flag )                                if  2drop drop i unloop exit  then                            loop 2drop ( n )  ;                                                                                                                                                                                                                                                                                                                                                                         ( test-case: )                                                  require case:                                                   : zx0 ." zero"  ;                                               : zx1 ." one"  ;                                                : zx2 ." two"  ;                                                case: zx  ( n -- )  zx0 zx1 zx2  ;                              3 associative: unzx  ( value -- n )  ' zx0 , ' zx1 , ' zx2 ,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ( ms )                                                          [defined] sys-frames ?\ 23672 constant sys-frames               : ms  ( n -- )                                                    20 / sys-frames @ +                                             begin  dup sys-frames @ u<  until drop  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ( frames@ frames! frames0 )                                     [defined] sys-frames ?\ 23672 constant sys-frames               : frames@  ( -- d )                                               sys-frames @ [ sys-frames 2+ ] literal c@  ;                  : frames!  ( d -- )                                               [ sys-frames 2+ ] literal c! sys-frames !  ;                  : frames0  ( -- )  0. frames!  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ( .context .current order vocs )                                : .context  ( -- )  context #vocs 0 do                                                dup @ ?dup if  pfa>nfa id.  then  cell+                       loop drop  ;                                : .current  ( -- )  current @ pfa>nfa id.  ;                    : order  ( -- )                                                   cr ." context: " .context cr ." current: " .current  ;        : vocs  ( -- )                                                    voc-link @                                                      begin  dup cell - pfa>nfa id.  @ dup 0= until  drop  ;                                                                                                                                                                                                                                                                                                                                                                                                        ( get-order set-order )                                         variable #order  \ number of vocs in the current search order   : (get-order)  ( -- widn..wid1 n)                                 0 swap do  context i cells + @  -1 +loop  ;                   : get-order  ( -- 0 | widn..wid1 n)                               #order @ ?dup if  (get-order)  then  #order @  ;              : (set-order)  ( widn..wid1 n -- )                                0 do  context i cells + !  loop  ;                            : set-order  ( -1 | 0 | widn..wid1 n -- )                         dup -1 =  if  drop only exit  then                              dup #order ! ?dup if  (set-order)  then  ;                                                                                                                                                                                                                                                                                                                                                    ( seed rnd random randomize )                                   [defined] seed                                                  ?\ 23670 constant seed  \ system variable                       : rnd  ( -- n )  seed @ 31421 * 6927 + dup seed !  ;            : random  ( n -- 0..n-1 )  rnd um* nip  ;                       : randomize  ( n -- )  seed !  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ( xrnd )                                                        [defined] seed                                                  ?\ 23670 constant seed  \ system variable                       code xrnd  ( -- x )                                               seed hl ftp  hl push                                            hl addp  hl addp  hl addp  hl addp  hl addp  hl addp            de pop  de addp  d# 41 de ldp#  de addp                         seed hl stp                                                     next,                                                           end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( random-test )                                                 require random  require set-pixel                               : random-test  ( n -- )                                           0 do  256 random 193 random set-pixel  loop  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ( defer defer@ defer! defers action-of )                        : (defer)  ( -- )  15 error  ;                                  : defer  ( "name" -- )  create ['] (defer) , does> @ execute  ; : defer@  ( cfa1 -- cfa2 )  cfa>pfa @  ;                        : defer!  ( cfa1 cfa2 -- )  cfa>pfa !  ;                        : defers  ( "name" -- )  ' defer@ ,  ; immediate                : action-of  ( Interpretation: "name" -- cfa )                               ( Compilation:    "name" -- )                                   ( Runtime:        -- cfa )                           ' comp? if    postpone literal postpone defer@                          else  defer@  then  ; immediate                                                                                                                                                                                                                                                                                                                                                       ( <is> [is] is  )                                               : <is>  ( cfa "name" -- )  ' defer!  ;                          : [is]  ( cfa "name" -- )                                         ' postpone literal postpone defer!  ; immediate               : is  ( cfa "name" -- )                                           comp? if  postpone [is]  else  <is>  then  ; immediate                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ( z80-asm )                                                     \ Z80 Assembler for Solo Forth                                  only forth definitions                                          : 8*   ( n1 -- n2 )  2* 2* 2*  ;                                : z80-asm  ( -- )  assembler  ;                                 also assembler definitions hex                                  -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( z80-asm -- registers )                                        0 constant b   1 constant c   2 constant d   3 constant e       4 constant h   5 constant l   6 constant m   7 constant a       0 constant bc  2 constant de  4 constant hl                     6 constant sp  6 constant af                                    DD constant ix-op  FD constant iy-op                            : ix  ( -- rphl )  ix-op c, hl  ;                               : iy  ( -- rphl )  iy-op c, hl  ;                               : ?page  ( n -- n )  dup 80 + FF swap u< 1E ?error  ;           -->                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( z80-asm -- words for defining the z80 instructions)           : m1  ( 8b "name" -- )                                            create c, does>  ( -- )  ( pfa ) c@ c,  ;                     : m2  ( 8b "name" -- )                                            create c, does>  ( r -- )  ( r pfa ) c@ + c,  ;               : m3  ( 8b "name" -- )                                            create c, does>  ( r -- )  ( r pfa ) c@ swap 8* + c,  ;       : m4  ( 8b "name" -- )                                            create c, does>  ( 8b -- )  ( 8b pfa ) c@ c, c,  ;            : m5  ( 8b "name" -- )                                            create c, does>  ( 16b -- )  ( 16b pfa ) c@ c, ,  ;           : m6  ( 8b "name" -- )                                            create c, does>  ( r -- )  ( r pfa ) CB c, c@ + c,  ;           -->                                                                                                                                                                                           ( z80-asm -- words for defining the z80 instructions)           : m7  ( 8b "name" -- )                                            create c, does>  ( bit r -- )                                     ( bit r pfa ) CB c, c@ + swap 8* + c,  ;                    : m8  ( 16b "name" -- )                                           create , does>  ( -- )  ( pfa ) @ ,  ;                        : m9  ( 8b "name" -- )                                            create c, does>  ( a -- )                                         ( a pfa )  c@ c, here 1+ - ?page c,  ;                      -->                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( z80-asm -- words for defining the z80 instructions)           require -rot                                                    : ma  ( 8b "name" -- )                                            create c, does>  ( disp rphl -- )                                 ( disp rphl pfa ) c@ c, drop c,  ;                          : mb  ( 8b "name" -- )                                            create c, does>  ( disp rphl -- )                                 ( disp rphl pfa ) CB c, c@ c, drop c,  ;                    : mc  ( 8b "name" -- )                                            create c, does>  ( bit rphl disp -- )                             ( bit rphl disp pfa ) CB c, rot drop c@ -rot c, 8* + c,  ;    -->                                                                                                                                                                                                                                                                                                                           ( z80-asm -- opcodes)                                           00 m1 nop 02 m3 stap 03 m3 incp 04 m3 inc 05 m3 dec 07 m1 rlca  08 m1 exaf 09 m3 addp 0A m3 ftap 0B m3 decp 0F m1 rrca          10 m9 djnz 17 m1 rla 18 m9 jr  1F m1 rra 20 m9 jrnz 22 m5 sthl  27 m1 daa 28 m9 jrz 2A m5 ldhl 2F m1 cpl 30 m9 jrnc 32 m5 sta   37 m1 scf 38 m9 jrc 3A m5 fta 3F m1 ccf 76 m1 halt 80 m2 add    88 m2 adc 90 m2 sub 98 m2 sbc B8 m2 cp C1 m3 pop C2 m5 jpnz     C3 m5 jp C5 m3 push C6 m4 add# C7 m2 rst C9 m1 ret CA m5 jpz    CD m5 call CE m4 adc# D2 m5 jpnc D3 m4 out 41 m3 outbc          D6 m4 sub# D9 m1 exx DA m5 jpc DB m4 in 40 m3 inbc 0DE m4 sbc#  E2 m5 jppo E3 m1 exsp E6 m4 and# E9 m1 jphl EA m5 jppe          EB m1 exde EE m4 xor# F2 m5 jpp F3 m1 di  F6 m4 or# F9 m1 ldsp  FA m5 jpm FB m1 ei FE m4 cp# 00 m6 rlc 08 m6 rrc 10 m6 rl       18 m6 rr 20 m6 sla  28 m6 sra 38 m6 srl  40 m7 bit 80 m7 res    C0 m7 set B0ED m8 ldir B8ED m8 lddr 44ED m8 neg 57ED m8 ldai    47ED m8 ldia 56ED m8 im1 5EED m8 im2 B1ED m8 cpir         -->   ( z80-asm -- opcodes)                                           : 0outbc  ( -- )  ED c, 71 c,  ;                                : jpix  ( -- )  ix-op c, jphl  ;                                : ldp#  ( 16b rp -- )  8* 1+ c, ,  ;                            : ld#  ( 8b r -- )  8* 06 + c, c,  ;                            : ld  ( r1 r2 -- )  8* 40 + + c,  ;                             : sbcp  ( rp -- )  ED c, 8* 42 + c,  ;                          : adcp  ( rp1 rp2 -- )  ED c, 8* 4A + c,  ;                     : stp  ( a rp -- )  ED c, 8* 43 + c, ,  ;                       : ftp  ( a rp -- )  ED c, 8* 4B + c, ,  ;                       : clr  ( rp -- )  0 swap ldp#  ;                                : ldp  ( rp1 rp2 -- )  2dup ld 1+ swap 1+ swap ld  ;            CF m4 hook \ rst 8                                              D7 m1 prt  \ rst 0x16                                           -->                                                                                                                             ( z80-asm -- index register opcodes)                            require -rot                                                    [defined] 3dup                                                  ?\ : 3dup  ( x1 x2 x3 -- x1 x2 x3 x1 x2 x3 )  dup 2over rot  ;  86 ma addx 8E ma adcx 96 ma subx 9E ma sbcx A6 ma andx          AE ma xorx B6 ma orx  BE ma cpx  34 ma incx 35 ma decx          06 mb rlcx 0E mb rrcx 16 mb rlx  1E mb rrx  26 mb slax          2E mb srax 3E mb srlx 46 mc bitx 86 mc resx C6 mc setx          : ftx   ( disp rpi r -- )   nip 8* 46 + c, c,  ;                : stx   ( r disp rphl -- )  drop swap 70 + c, c,  ;             : st#x  ( 8b disp rpi -- )  drop 36 c, swap c, c,  ;            : ftpx  ( disp rpi rp -- )  3dup 1+ ftx rot 1+ -rot ftx  ;      : stpx  ( disp rpi rp -- )  3dup 1+ stx rot 1+ -rot stx  ;      -->                                                                                                                                                                                             ( z80-asm -- conditional ret and call)                          20 constant z  28 constant nz  30 constant cy  38 constant nc   C2 constant z'  CA constant nz' D2 constant cy' DA constant nc' E2 constant pe' EA constant po' F2 constant m'  FA constant p'  : ?ret  ( op -- )  8 xor 2- c,  ;                               : retc  ( -- )  cy' ?ret ;    : retnc  ( -- )  nc' ?ret  ;      : retz  ( -- )  z' ?ret ;     : retnz  ( -- )  nz' ?ret  ;      : retm  ( -- )  m' ?ret ;     : retp  ( -- )  p' ?ret  ;        : retpe  ( -- )  pe' ?ret ;   : retpo  ( -- )  po' ?ret  ;      : ?call  ( a op -- )  8 xor 2+ c, ,  ;                          : callc  ( -- )  cy' ?call ;    : callnc  ( -- )  nc' ?call  ;  : callz  ( -- )  z' ?call ;     : callnz  ( -- )  nz' ?call  ;  : callm  ( -- )  m' ?call ;     : callp  ( -- )  p' ?call  ;    : callpe  ( -- )  pe' ?call ;   : callpo ( -- )  po' ?call  ;   -->                                                                                                                             ( z80-asm -- control structures with relative jumps)            : >relmark  ( -- dest )  here 1-  ;                             : >relresolve  ( orig dest -- ) over - ?page swap c!  ;         : then  ( orig cs-id -- )  0A ?pairs >relmark >relresolve  ;    : if  ( op -- orig cs-id )  , >relmark 0A  ;                    : else  ( orig cs-id -- cs-id ) \ XXX TODO document               0A ?pairs 18 if rot swap then 0A  ;                           : begin  (  -- dest cs-id )  <mark 0B  ;                        : while  (  op -- orig cs-id )  if 2+  ;                        : until  (  dest cs-id op -- )                                    , 0B ?pairs 1- >relmark swap >relresolve  ;                   : again  (  dest cs-id -- )  18 until  ;                        : dsz    ( dest cs-id -- )  10 until  ;                         : repeat  (  dest cs-id1 orig cs-id2 )  2swap again 2- then  ;  -->                                                                                                                             ( z80-asm -- control structures with absolute jumps)            : then'  (  orig cs-id -- )  08 ?pairs >resolve  ;              : if'  (  op -- orig cs-id )  c, >mark 08  ;                    : else'  (  cs-id -- cs-id )                                      08 ?pairs C3 if' rot swap then' 08  ;                         : begin'  (  -- dest cs-id )  <mark 09  ;                       : while'  (  op -- orig cs-id )  if' 2+  ;                      : until'  (  cs-id op -- )  c, 09 ?pairs <resolve  ;            : again'  (  cs-id -- )  C3 until'  ;                           : repeat'  (  dest cs-id1 orig cs-id2 )                           2swap again' 2- then'  ;                                      -->                                                                                                                                                                                                                                                                                                                             ( z80-asm -- last opcodes and macros)                           A0 m2 and  B0 m2 or  A8 m2 xor                                  : subp  ( rp -- )  a and sbcp  ;                                : tstp  ( rp -- )  dup a ld 1+ or  ;                            -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( z80-asm -- definining words)                                  variable abase  \ backup of `base`                              only forth definitions also assembler                           : macro  ( "name" -- )  asm postpone :  ;                       : endm  ( -- )  postpone ;  ;                                   decimal only forth                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ( a! a@ )                                                       variable a                                                      code a!  ( a -- )                                                 E1 c,                 \ pop hl                                  22 c, a ,             \ ld (a),hl                               jpnext                \ jp (ix)                                 end-code                                                      code a@  ( -- a )                                                 2A c, a ,             \ ld hl,(a)                               C3 c, pushhl ,        \ jp pushhl                               end-code                                                                                                                                                                                                                                                                                                                                                                                      ( !a @a )                                                       do-require address-register                                     code !a  ( u -- )                                                 D1 c,                          \ pop de                         2A c, a ,                      \ ld hl,(a)                      70 03 + c,  23 c,  70 04 + c,  \ ld (hl),e  inc hl  ld (hl),d   jpnext                         \ jp (ix)                        end-code                                                      code @a  ( -- u )                                                 2A c, a ,             \ ld hl,(a)                               5E c,                 \ ld e,(hl)                               23 c,                 \ inc hl                                  66 c,                 \ ld h,(hl)                               68 03 + c,            \ ld l,e                                  C3 c, pushhl ,        \ jp pushhl                               end-code                                                      ( c!a c@a )                                                     do-require address-register                                     code c!a  ( c -- )                                                D1 c,                 \ pop de                                  2A c, a ,             \ ld hl,(a)                               70 03 + c,            \ ld (hl),e                               jpnext                \ jp (ix)                                 end-code                                                      code c@a  ( -- c )                                                2A c, a ,             \ ld hl,(a)                               6E c,                 \ ld l,(hl)                               26 c, 00 c,           \ ld h,0                                  C3 c, pushhl ,        \ jp pushhl                               end-code                                                                                                                                                                                      ( !a+ @a+ )                                                     do-require address-register                                     code !a+  ( u -- )                                                D1 c,                 \ pop de                                  2A c, a ,             \ ld hl,(a)                               70 03 + c,  23 c,     \ ld (hl),e  inc hl                       70 04 + c,  23 c,     \ ld (hl),d  inc hl                       22 c, a ,  jpnext     \ ld (a),hl  jp (ix)                      end-code                                                      code @a+  ( -- u )      \ Fetch cell at `a` with increment.       2A c, a ,             \ ld hl,(a)                               5E c,  23 c,          \ ld e,(hl)  inc hl                       56 c,  23 c,          \ ld d,(hl)  inc hl                       22 c, a ,             \ ld (a),hl                               D5 c,  jpnext         \ push de  jp (ix)                        end-code                                                      ( c!a+ c@a+ )                                                   do-require address-register                                     code c!a+  ( c -- )                                               D1 c,                 \ pop de                                  2A c, a ,             \ ld hl,(a)                               70 03 + c,  23 c,     \ ld (hl),e  inc hl                       22 c, a ,  jpnext     \ ld (a),hl  jp (ix)                      end-code                                                      code c@a+  ( -- c )                                               2A c, a ,             \ ld hl,(a)                               5E c,  23 c,          \ ld e,(hl)  inc hl                       06 c, 00 c,           \ ld d,0                                  22 c, a ,             \ ld (a),hl                               D5 c,  jpnext         \ push de  jp (ix)                        end-code                                                                                                                      ( heap )                                                        forth definitions                                               vocabulary heap-voc                                             heap-voc definitions                                            : unique (  )  VARIABLE  ;                                      0 1 2 UM/MOD NIP 1- CONSTANT maxpos                             256 CELLS CONSTANT heapsize                                     4 CELLS 1- CONSTANT hysteresis                                  unique allocationerror                                          3 CELLS CONSTANT headsize                                       : adjustsize ( n -- n)  headsize +  hysteresis OR  1+  ;        0 adjustsize CONSTANT overhead                                  CREATE sentinel  HERE CELL+ ,  maxpos ,  0 ,  0 ,               CREATE heap  heapsize ALLOT                                     VARIABLE nextnode  -->                                                                                                          ( heap )                                                        : >size ( addr -- addr)  CELL+  ;                               : >prev ( addr -- addr)  2 CELLS +  ;                           : init-heap (  )  heap DUP nextnode !                                 DUP DUP !                                                       DUP heapsize  OVER >size !                                      >prev !  ;                                                init-heap                                                       : attach ( addr)  >prev @                                             DUP sentinel ROT !                                              sentinel >prev !  ;                                       : search  ( addr size -- addr|0)                                    >R BEGIN 2@ SWAP R@ < INVERT UNTIL                              R> DROP  >prev @  ;                                         : detach ( addr)  DUP >prev @ !  ;                              -->                                                             ( heap )                                                        : findspace ( size -- addr|0)  nextnode @                                  DUP      attach                                                 DUP ROT  search                                                 SWAP     detach  ;                                   : fits ( size addr -- flag)  >size @ SWAP -  overhead  <  ;     : togglesize ( addr)  >size DUP @  NEGATE SWAP !  ;             : next! ( addr)  nextnode !  ;                                  : sizes! ( size addr -- addr)  2DUP + >R                                   >size 2DUP @ SWAP -                                             R@ >size !                                                      SWAP NEGATE SWAP !  R>  ;                            : links! ( addr1 addr2)  2DUP SWAP @  2DUP  SWAP !  >prev !                   2DUP >prev !   SWAP !  ;                          : newnode ( size addr)  TUCK sizes!  links!  ;                  -->                                                             ( heap )                                                        : makenode ( size addr)  2DUP fits IF  togglesize DROP                   ELSE  newnode                                                   THEN  ;                                                FORTH-WORDLIST SET-CURRENT                                      : ALLOCATE ( u -- addr ior)                                         DUP 0< IF  allocationerror                                           ELSE  adjustsize                                                DUP findspace                                                   DUP IF  DUP next!                                                 TUCK makenode                                                   headsize +  0                                                   ELSE  DROP allocationerror                                      THEN                                                          THEN  ;                                                MEMORY-ALLOC-WORDLIST SET-CURRENT  -->                          ( heap )                                                        : mergesizes ( addr addr)                                              >size @ SWAP >size +!  ;                                 : mergelinks ( addr addr)                                              @ 2DUP SWAP !                                                   >prev !  ;                                               : jiggle (  )                                                      nextnode @ @  >prev @  next!  ;                              : merge ( addr)                                                   DUP @ 2DUP mergesizes                                                mergelinks  jiggle  ;                                    : ?merge ( addr1 addr2)  >size @                                       0> IF  DUP DUP @                                                 U< IF  DUP merge                                                   THEN                                                           THEN  DROP ;  -->                                     ( heap )                                                        : ?mergenext ( addr)  DUP @ ?merge  ;                           : ?mergeprev ( addr)  >prev @ DUP ?merge  ;                     FORTH-WORDLIST SET-CURRENT                                      : FREE ( addr -- ior)  headsize -                                        DUP togglesize                                                  DUP ?mergenext                                                  ?mergeprev  0  ;                                       MEMORY-ALLOC-WORDLIST SET-CURRENT                               VARIABLE stash                                                  : savelink ( addr)  @ stash !  ;                                : restorelink ( addr)  stash @  SWAP !  ;                       : fixprev ( addr)  DUP >prev @ !  ;                             : fixnext ( addr)  DUP @ >prev !  ;                             : fixlinks ( addr)  DUP fixprev  DUP fixnext  @ fixnext  ;      -->                                                             ( heap )                                                        : fixsize ( addr)  DUP >size @ 0>                                      IF  DUP @  2DUP <                                                   IF  OVER - SWAP >size !                                       ELSE 2DROP                                                      THEN                                                        ELSE  DROP                                                      THEN  ;                                                    : fixsizes ( addr)  DUP fixsize  >prev @ fixsize  ;             : repair ( addr)  DUP restorelink                                     DUP fixlinks  DUP fixsizes                                      togglesize  ;                                             : toobig? ( addr size -- flag)                                      SWAP  >size @  >  ;                                         -->                                                                                                                             ( heap )                                                        : copynode ( addr1 addr2)                                              OVER >size @  headsize -                                        ROT  headsize + ROT ROT MOVE  ;                          : enlarge ( addr1 size -- addr2 ior)                                OVER  ?mergeprev                                                ALLOCATE DUP >R                                                 IF  SWAP repair                                               ELSE  TUCK copynode                                             THEN R>  ;                                                    : adjust ( addr1 size1 -- addr2 size2)  adjustsize >R                         headsize -                                                      DUP savelink                                                    DUP togglesize                                                  DUP ?mergenext R>  ;                              -->                                                             ( heap )                                                        FORTH-WORDLIST SET-CURRENT                                      : RESIZE ( addr1 u -- addr2 ior)                                  DUP 0<  IF  DROP allocationerror                                        ELSE  adjust  2DUP toobig?                                            IF enlarge                                                      ELSE  OVER makenode headsize +  0  THEN                   THEN  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               